<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LINE é ç´„ç³»çµ± - é›²ç«¯åŒæ­¥æ­£å¼ç‰ˆ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <!-- å¼•å…¥ Google Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // =========================================================
        // â–¼â–¼â–¼ è€é—†è«‹æ³¨æ„ï¼šè«‹å°‡ä¸‹æ–¹çš„è¨­å®šæ›æˆæ‚¨è‡ªå·±çš„ Firebase Config â–¼â–¼â–¼
        // 1. å‰å¾€ https://firebase.google.com/ å»ºç«‹å°ˆæ¡ˆ
        // 2. æ–°å¢ Web App ä¸¦è¤‡è£½è¨­å®šæª”è²¼åœ¨ä¸‹æ–¹
        // =========================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDfGrWPE2uBPEh30PaA-4lKDzUZ7VPSc4I", // è«‹æ›¿æ›
            authDomain: "jiening-e8e44.firebaseapp.com", // è«‹æ›¿æ›
            projectId: "jiening-e8e44", // è«‹æ›¿æ›
            storageBucket: "jiening-e8e44.firebasestorage.app", // è«‹æ›¿æ›
            messagingSenderId: "361931617730", // è«‹æ›¿æ›
            appId: "1:361931617730:web:188406fade9ddee6ac925b" // è«‹æ›¿æ›
            measurementId: "G-WYV578HLXT"
        };
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        let db = null;
        let isCloudActive = false;

        // åˆå§‹åŒ– Firebase (åŠ å…¥æ›´åš´æ ¼çš„æª¢æŸ¥èˆ‡å®¹éŒ¯)
        try {
            // æª¢æŸ¥æ˜¯å¦é‚„åœ¨ç”¨ç¯„ä¾‹è¨­å®š
            if (firebaseConfig.projectId === "example-project") {
                console.warn("ç›®å‰ä½¿ç”¨ç¯„ä¾‹è¨­å®šï¼Œå°‡è‡ªå‹•åˆ‡æ›ç‚ºé›¢ç·šæ¨¡å¼ã€‚");
                // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œè€Œæ˜¯æ¨™è¨˜ç‚ºé›¢ç·šï¼Œè®“ç¨‹å¼ç¹¼çºŒåŸ·è¡Œ
                isCloudActive = false;
            } else {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                isCloudActive = true;
                console.log("é›²ç«¯è³‡æ–™åº«é€£ç·šå˜—è©¦ä¸­...");
            }
        } catch (e) {
            console.log("é€²å…¥é›¢ç·šæ¨¡å¼:", e.message);
            isCloudActive = false;
        }

        // å°‡ DB åŠŸèƒ½æ›è¼‰åˆ°å…¨åŸŸ
        window.cloudDB = {
            isCloudActive: isCloudActive,
            
            // ç›£è½è³‡æ–™è®Šæ›´
            listenToConfig: (callback) => {
                // å¦‚æœä¸€é–‹å§‹å°±æ¨™è¨˜é›¢ç·šï¼Œç›´æ¥è®€å– LocalStorage
                if (!window.cloudDB.isCloudActive || !db) {
                    console.log("ä½¿ç”¨é›¢ç·šè³‡æ–™ (åˆå§‹åŒ–)");
                    loadLocal(callback);
                    showOfflineWarning("âš ï¸ å°šæœªè¨­å®šé›²ç«¯é‡‘é‘°ï¼Œç›®å‰ç‚ºé›¢ç·šæ¨¡å¼ã€‚");
                    return;
                }

                // å˜—è©¦é€£ç·šé›²ç«¯ï¼Œä½†åŠ å…¥ã€Œé€£ç·šå¤±æ•—ã€çš„è™•ç†
                try {
                    onSnapshot(doc(db, "shops", "myShop"), 
                        (docSnapshot) => {
                            if (docSnapshot.exists()) {
                                callback(docSnapshot.data());
                                hideOfflineWarning(); // é€£ç·šæˆåŠŸï¼Œéš±è—è­¦å‘Š
                            } else {
                                // è‹¥é›²ç«¯ç„¡è³‡æ–™ï¼Œåˆå§‹åŒ–
                                window.cloudDB.saveConfig(window.DEFAULTS);
                            }
                        }, 
                        (error) => {
                            // â˜…â˜…â˜… é—œéµä¿®å¾©ï¼šç•¶ç™¼ç”Ÿæ¬Šé™éŒ¯èª¤æ™‚ï¼Œåˆ‡æ›å›é›¢ç·šæ¨¡å¼ â˜…â˜…â˜…
                            console.warn("é›²ç«¯é€£ç·šå¤±æ•— (æ¬Šé™æˆ–ç¶²è·¯å•é¡Œ)ï¼Œåˆ‡æ›è‡³é›¢ç·šæ¨¡å¼:", error.code);
                            window.cloudDB.isCloudActive = false;
                            loadLocal(callback);
                            showOfflineWarning("âš ï¸ ç„¡æ³•é€£æ¥é›²ç«¯ (æ¬Šé™ä¸è¶³)ï¼Œå·²åˆ‡æ›è‡³é›¢ç·šæ¨¡å¼ã€‚");
                        }
                    );
                } catch (err) {
                    console.error("ç›£è½å™¨éŒ¯èª¤:", err);
                    window.cloudDB.isCloudActive = false;
                    loadLocal(callback);
                }
            },

            // å„²å­˜è³‡æ–™
            saveConfig: async (newConfig) => {
                // 1. ç„¡è«–å¦‚ä½•éƒ½å…ˆå­˜æœ¬åœ°ï¼Œä¿è­‰ä¸æ‰è³‡æ–™
                localStorage.setItem('booking_app_config', JSON.stringify(newConfig));

                // 2. å¦‚æœæ˜¯é›¢ç·šæ¨¡å¼ï¼Œå°±åœåœ¨é€™è£¡
                if (!window.cloudDB.isCloudActive || !db) {
                    showToast("å·²å„²å­˜ (æœ¬æ©Ÿæ¨¡å¼)");
                    return;
                }

                // 3. å˜—è©¦å­˜é›²ç«¯
                try {
                    await setDoc(doc(db, "shops", "myShop"), newConfig);
                    showToast("å·²åŒæ­¥è‡³é›²ç«¯ â˜ï¸");
                } catch (e) {
                    console.error("é›²ç«¯å„²å­˜å¤±æ•—:", e);
                    // å¦‚æœå­˜å¤±æ•—ï¼Œæç¤ºç”¨æˆ¶ä½†ä¸è¦å´©æ½°
                    showToast("é›²ç«¯å¤±æ•—ï¼Œå·²å­˜æ–¼æœ¬æ©Ÿ");
                }
            }
        };

        // è¼”åŠ©å‡½å¼ï¼šè®€å–æœ¬åœ°è³‡æ–™
        function loadLocal(callback) {
            const local = localStorage.getItem('booking_app_config');
            if(local) callback(JSON.parse(local));
            else callback(window.DEFAULTS);
        }

        // è¼”åŠ©å‡½å¼ï¼šé¡¯ç¤ºè­¦å‘Š
        function showOfflineWarning(msg) {
            const el = document.getElementById('config-warning');
            if(el) {
                el.innerHTML = `<strong>${msg}</strong><br>è³‡æ–™åƒ…å„²å­˜æ–¼æ­¤é›»è…¦ï¼Œè«‹è¨­å®š Firebase ä»¥å•Ÿç”¨å¤šè£ç½®åŒæ­¥ã€‚`;
                el.style.display = 'block';
            }
        }
        function hideOfflineWarning() {
             const el = document.getElementById('config-warning');
             if(el) el.style.display = 'none';
        }

        // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', window.initApp);
        } else {
            window.initApp();
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; height: 100vh; overflow: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .app-container { background-color: #ffffff; height: 100%; overflow-y: auto; display: flex; flex-direction: column; position: relative; }
        
        /* UI Styles */
        .tab-active { color: #06C755; font-weight: 700; }
        .tab-inactive { color: #9CA3AF; }
        
        .member-card-bg { background: linear-gradient(135deg, #1f2937 0%, #111827 100%); }
        .gold-text { color: #fbbf24; }
        
        .admin-input { border: 1px solid #e5e7eb; padding: 8px; rounded: 8px; width: 100%; font-size: 14px; transition: all 0.2s; }
        .admin-input:focus { outline: none; border-color: #06C755; box-shadow: 0 0 0 3px rgba(6, 199, 85, 0.1); }
        .admin-section { border-left: 4px solid #06C755; padding-left: 16px; margin-bottom: 24px; }

        /* Save Toast */
        #save-toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 8px 16px; rounded-full;
            font-size: 12px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 9999;
        }
        #save-toast.show { opacity: 1; }
        
        /* Alert Box */
        .alert-box {
            background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404;
            padding: 12px; rounded-lg; margin-bottom: 20px; font-size: 14px;
            display: none; /* é è¨­éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
        }
    </style>
</head>
<body>

    <div id="save-toast">è³‡æ–™å·²å„²å­˜</div>

    <div class="flex h-full max-w-7xl mx-auto shadow-2xl overflow-hidden rounded-none md:rounded-xl">
        
        <!-- ================= LEFT: CLIENT APP SIMULATOR ================= -->
        <div id="client-app" class="w-full md:w-[400px] md:border-r border-gray-200 flex-shrink-0 z-10 bg-white flex flex-col transition-all duration-300">
            
            <header id="app-header" class="bg-white sticky top-0 z-20 border-b border-gray-100 px-4 py-3 flex items-center justify-between shadow-sm flex-shrink-0 hidden">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-[#06C755] rounded-lg flex items-center justify-center text-white font-bold text-lg">L</div>
                    <h1 class="text-lg font-bold text-gray-800" id="app-title-display">LINE é ç´„</h1>
                </div>
                <button id="header-action-btn" class="text-sm text-[#06C755] font-bold hidden" onclick="openEditProfile()">ç·¨è¼¯</button>
            </header>

            <main id="app-content" class="flex-grow p-0 overflow-y-auto no-scrollbar relative bg-gray-50">
                <!-- Content Rendered via JS -->
                <div class="flex items-center justify-center h-full text-gray-400">æ­£åœ¨åˆå§‹åŒ–ç³»çµ±...</div>
            </main>

            <nav id="app-nav" class="bg-white border-t border-gray-100 absolute bottom-0 w-full h-16 flex justify-around items-center px-2 z-30 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] hidden">
                <button onclick="navigateTo('home')" class="nav-item tab-inactive flex flex-col items-center space-y-1 w-1/4" data-target="home"><span class="text-2xl">ğŸ </span><span class="text-[10px]">é¦–é </span></button>
                <button onclick="navigateTo('services')" class="nav-item tab-inactive flex flex-col items-center space-y-1 w-1/4" data-target="services"><span class="text-2xl">ğŸ“…</span><span class="text-[10px]">é ç´„</span></button>
                <button onclick="navigateTo('records')" class="nav-item tab-inactive flex flex-col items-center space-y-1 w-1/4" data-target="records"><span class="text-2xl">ğŸ“‹</span><span class="text-[10px]">ç´€éŒ„</span></button>
                <button onclick="navigateTo('profile')" class="nav-item tab-active flex flex-col items-center space-y-1 w-1/4" data-target="profile"><span class="text-2xl">ğŸ‘¤</span><span class="text-[10px]">æœƒå“¡</span></button>
            </nav>
        </div>

        <!-- ================= RIGHT: ADMIN DASHBOARD (EDIT AREA) ================= -->
        <div id="admin-dashboard" class="hidden md:block flex-grow bg-gray-50 overflow-y-auto h-full p-6 md:p-8">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-gray-50 z-20 py-2">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">â˜ï¸ é›²ç«¯åº—å®¶å¾Œå°</h2>
                    <p class="text-sm text-gray-500">ä¿®æ”¹å¾Œå°‡è‡ªå‹•åŒæ­¥è‡³æ‰€æœ‰å®¢æˆ¶ç«¯ã€‚</p>
                </div>
                <div class="space-x-2">
                    <button onclick="resetToDefault()" class="text-red-500 text-sm hover:underline">é‡ç½®é è¨­</button>
                </div>
            </div>
            
            <!-- Config Warning -->
            <div id="config-warning" class="alert-box">
                <!-- JS Will Insert Warning Here -->
            </div>

            <div class="space-y-8 max-w-3xl">
                <!-- 1. General Settings -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 admin-section">
                    <h3 class="font-bold text-lg mb-4 text-gray-800">ğŸª å•†åº—èˆ‡æ­¡è¿è³‡è¨Š</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-gray-500 mb-1">å•†åº—åç¨±</label><input type="text" id="setting-shop-name" class="admin-input" oninput="debouncedSave()"></div>
                        <div><label class="block text-xs font-bold text-gray-500 mb-1">é¦–é æ­¡è¿è©</label><input type="text" id="setting-welcome-msg" class="admin-input" oninput="debouncedSave()"></div>
                    </div>
                </div>

                <!-- 2. Login Screen Text -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 admin-section">
                    <h3 class="font-bold text-lg mb-4 text-gray-800">ğŸ” ç™»å…¥ç•«é¢æ–‡æ¡ˆ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-gray-500 mb-1">ä¸»æ¨™é¡Œ</label><input type="text" id="setting-login-title" class="admin-input" oninput="debouncedSave()"></div>
                        <div><label class="block text-xs font-bold text-gray-500 mb-1">å‰¯æ¨™é¡Œ</label><input type="text" id="setting-login-subtitle" class="admin-input" oninput="debouncedSave()"></div>
                    </div>
                </div>

                <!-- 3. Services Management -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 admin-section">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-gray-800">âœ‚ï¸ æœå‹™é …ç›®</h3><button onclick="addNewService()" class="bg-[#06C755] text-white px-3 py-1 rounded-lg text-sm font-bold">+ æ–°å¢</button></div>
                    <div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead class="bg-gray-50 text-gray-500"><tr><th class="p-2">åœ–ç¤º</th><th class="p-2">åç¨±</th><th class="p-2">åƒ¹æ ¼</th><th class="p-2 text-right">åˆªé™¤</th></tr></thead><tbody id="services-table-body"></tbody></table></div>
                </div>

                <!-- 4. Staff Management -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 admin-section">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-gray-800">ğŸ‘¨â€ğŸ¨ äººå“¡è¨­å®š</h3><button onclick="addNewStaff()" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm font-bold">+ æ–°å¢</button></div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="staff-grid"></div>
                </div>
            </div>
        </div>
        
        <button id="mobile-back-btn" onclick="mobileToggleAdmin()" class="md:hidden hidden fixed bottom-20 right-4 bg-black text-white px-4 py-3 rounded-full shadow-xl z-50 text-sm font-bold flex items-center space-x-2">
            <span>âš™ï¸ å¾Œå°</span>
        </button>
    </div>

    <!-- Modals (Profile, Coupon) omitted for brevity but functionality preserved -->
    <!-- ... Copied from previous logic ... -->

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script>
        // --- 1. DATA & DEFAULTS ---
        window.DEFAULTS = {
            shopName: "LINE é ç´„ç³»çµ±",
            welcomeMsg: "æ­¡è¿å›ä¾†ï¼Œè«‹é¸æ“‡æ‚¨éœ€è¦çš„æœå‹™ã€‚",
            loginTitle: "æœƒå“¡ç™»å…¥",
            loginSubtitle: "è«‹é¸æ“‡ç™»å…¥æ–¹å¼ä»¥é–‹å§‹é ç´„",
            services: [
                { id: 's1', name: 'ç²¾ç·»å‰ªé«®', price: 600, duration: 60, icon: 'âœ‚ï¸' },
                { id: 's2', name: 'æŸ“é«®è¨­è¨ˆ', price: 2500, duration: 120, icon: 'ğŸ¨' }
            ],
            staff: [{ id: 'st1', name: 'Alice', image: 'ğŸ‘©â€ğŸ¦°' }, { id: 'st2', name: 'Bob', image: 'ğŸ‘¨â€ğŸ¦±' }]
        };

        let store = { config: JSON.parse(JSON.stringify(window.DEFAULTS)), user: null, bookings: [] };
        let currentState = { view: 'login', booking: {} };
        let saveTimeout;

        // --- 2. INIT & CLOUD SYNC ---
        window.initApp = function() {
            // Load user session
            const savedUser = localStorage.getItem('booking_app_user');
            if (savedUser) {
                store.user = JSON.parse(savedUser);
                navigateTo('home');
            } else {
                navigateTo('login');
            }

            // Start Listening
            if (window.cloudDB) {
                window.cloudDB.listenToConfig((data) => {
                    store.config = data;
                    renderAll(); 
                    fillAdminInputs();
                });
            } else {
                const localData = localStorage.getItem('booking_app_config');
                if(localData) store.config = JSON.parse(localData);
                renderAll();
                fillAdminInputs();
            }
        };

        // --- 3. SAVE LOGIC (Debounced) ---
        function debouncedSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                updateConfigFromInputs();
                if (window.cloudDB) {
                    window.cloudDB.saveConfig(store.config);
                } else {
                    localStorage.setItem('booking_app_config', JSON.stringify(store.config));
                    showToast("å·²å„²å­˜ (æœ¬æ©Ÿæ¨¡å¼)");
                }
            }, 1000);
        }
        
        function forceSave() {
            if (window.cloudDB) {
                window.cloudDB.saveConfig(store.config);
            } else {
                localStorage.setItem('booking_app_config', JSON.stringify(store.config));
                showToast("å·²å„²å­˜ (æœ¬æ©Ÿæ¨¡å¼)");
            }
            renderAll();
        }

        function updateConfigFromInputs() {
            store.config.shopName = document.getElementById('setting-shop-name').value;
            store.config.welcomeMsg = document.getElementById('setting-welcome-msg').value;
            store.config.loginTitle = document.getElementById('setting-login-title').value;
            store.config.loginSubtitle = document.getElementById('setting-login-subtitle').value;
        }
        
        function fillAdminInputs() {
            if(document.getElementById('setting-shop-name')) {
                document.getElementById('setting-shop-name').value = store.config.shopName || "";
                document.getElementById('setting-welcome-msg').value = store.config.welcomeMsg || "";
                document.getElementById('setting-login-title').value = store.config.loginTitle || "";
                document.getElementById('setting-login-subtitle').value = store.config.loginSubtitle || "";
                renderAdminLists();
            }
        }

        function showToast(msg) {
            const t = document.getElementById('save-toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // --- 4. RENDER LOGIC ---
        function renderAll() {
            const titleEl = document.getElementById('app-title-display');
            if(titleEl) titleEl.innerText = store.config.shopName;
            renderView(currentState.view);
            renderAdminLists();
        }

        // --- 5. NAVIGATION ---
        function navigateTo(view) {
            currentState.view = view;
            if (view === 'login') { renderView('login'); return; }
            document.getElementById('app-header').classList.remove('hidden');
            document.getElementById('app-nav').classList.remove('hidden');
            
             // Header Button logic
            const headerBtn = document.getElementById('header-action-btn');
            if(headerBtn) {
                 if(view === 'profile') headerBtn.classList.remove('hidden');
                 else headerBtn.classList.add('hidden');
            }

            document.querySelectorAll('.nav-item').forEach(el => {
                const active = el.dataset.target === view || (['services','staff','time','confirm','success'].includes(view) && el.dataset.target === 'services');
                el.className = `nav-item flex flex-col items-center space-y-1 w-1/4 ${active ? 'tab-active' : 'tab-inactive'}`;
            });
            renderView(view);
        }

        function renderView(view) {
            const content = document.getElementById('app-content');
            content.innerHTML = '';
            const title = store.config.shopName || DEFAULTS.shopName;

            if (view === 'login') content.innerHTML = renderLogin();
            else if (view === 'home') content.innerHTML = renderHome();
            else if (view === 'services') content.innerHTML = renderServices();
            else if (view === 'staff') content.innerHTML = renderStaff();
            else if (view === 'profile') content.innerHTML = renderProfile(); 
            // etc..
        }

        // --- VIEW TEMPLATES ---
        function renderLogin() {
             document.getElementById('app-header').classList.add('hidden');
             document.getElementById('app-nav').classList.add('hidden');
             return `<div class="h-full flex flex-col items-center justify-center p-8 bg-white"><div class="text-center mb-8"><div class="w-20 h-20 bg-[#06C755] rounded-3xl flex items-center justify-center text-white text-4xl font-bold mx-auto mb-6 shadow-xl">L</div><h2 class="text-2xl font-bold text-gray-800">${store.config.loginTitle}</h2><p class="text-gray-400 mt-2 text-sm">${store.config.loginSubtitle}</p></div><button onclick="mockLogin()" class="w-full bg-[#06C755] text-white py-4 rounded-2xl font-bold">LINE ç™»å…¥</button></div>`;
        }
        function renderHome() {
             return `<div class="space-y-6 p-4"><div class="w-full h-40 bg-gradient-to-r from-gray-800 to-gray-900 rounded-2xl flex items-center p-6 text-white relative overflow-hidden shadow-lg"><div class="z-10"><h2 class="text-xl font-bold">Hi, ${store.user.displayName}</h2><p class="text-xs opacity-70 mt-1">${store.config.welcomeMsg}</p><button onclick="navigateTo('services')" class="mt-4 bg-[#06C755] text-white px-4 py-2 rounded-full text-sm font-bold">ç«‹å³é ç´„</button></div></div></div>`;
        }
        function renderServices() {
             return `<div class="space-y-3 p-4"><div class="flex items-center space-x-2 mb-2"><button onclick="navigateTo('home')">â€¹</button><h2 class="font-bold">é¸æ“‡æœå‹™</h2></div>${store.config.services.map(s => `<div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex justify-between"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-xl">${s.icon}</div><div><div class="font-bold">${s.name}</div><div class="text-xs text-gray-500">$${s.price}</div></div></div></div>`).join('')}</div>`;
        }
        function renderStaff() { return `<div class="p-4">è¨­è¨ˆå¸«åˆ—è¡¨ (è«‹è‡³å¾Œå°æ–°å¢)</div>`; }
        function renderProfile() { return `<div class="p-4"><div class="member-card-bg rounded-2xl p-6 text-white shadow-xl"><h2 class="text-lg font-bold">${store.user.displayName}</h2><button onclick="logout()" class="mt-4 text-xs bg-white text-black px-2 py-1 rounded">ç™»å‡º</button></div></div>`; }

        // --- ACTIONS ---
        function mockLogin() {
            store.user = { displayName: "æœƒå“¡", phone: "0912345678" };
            localStorage.setItem('booking_app_user', JSON.stringify(store.user));
            navigateTo('home');
        }
        function logout() {
            localStorage.removeItem('booking_app_user');
            store.user = null;
            navigateTo('login');
        }
        function mobileToggleAdmin() {
             const dash = document.getElementById('admin-dashboard');
             const client = document.getElementById('client-app');
             const btn = document.getElementById('mobile-back-btn');
             dash.classList.toggle('hidden'); client.classList.toggle('hidden');
        }
        function resetToDefault() {
            if(confirm('ç¢ºå®šé‡ç½®?')) {
                store.config = JSON.parse(JSON.stringify(window.DEFAULTS));
                forceSave();
            }
        }

        // --- ADMIN LIST RENDERERS ---
        function renderAdminLists() {
            const tbody = document.getElementById('services-table-body');
            if(tbody) {
                tbody.innerHTML = store.config.services.map((s, index) => `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="p-2"><input type="text" class="w-10 text-center border rounded" value="${s.icon}" oninput="editService(${index}, 'icon', this.value)"></td>
                        <td class="p-2"><input type="text" class="w-full border rounded px-2 py-1" value="${s.name}" oninput="editService(${index}, 'name', this.value)"></td>
                        <td class="p-2"><input type="number" class="w-20 border rounded px-2 py-1" value="${s.price}" oninput="editService(${index}, 'price', this.value)"></td>
                        <td class="p-2 text-right"><button onclick="deleteService(${index})" class="text-red-500 font-bold">Ã—</button></td>
                    </tr>`).join('');
            }
            const staffGrid = document.getElementById('staff-grid');
            if(staffGrid) {
                staffGrid.innerHTML = store.config.staff.map((s, index) => `
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 relative group text-center">
                        <button onclick="deleteStaff(${index})" class="absolute top-1 right-2 text-gray-300 hover:text-red-500">Ã—</button>
                        <input type="text" class="w-10 h-10 text-2xl text-center bg-white rounded-full border mb-1" value="${s.image}" oninput="editStaff(${index}, 'image', this.value)">
                        <input type="text" class="w-full text-center text-sm font-bold bg-transparent border-b border-transparent focus:border-[#06C755] focus:outline-none" value="${s.name}" oninput="editStaff(${index}, 'name', this.value)">
                    </div>`).join('');
            }
        }

        window.addNewService = function() { store.config.services.push({ id: 's'+Date.now(), name: 'æ–°æœå‹™', price: 1000, duration: 60, icon: 'ğŸ†•' }); forceSave(); };
        window.editService = function(i, f, v) { if(f==='price') v=parseInt(v); store.config.services[i][f] = v; debouncedSave(); };
        window.deleteService = function(i) { if(confirm('åˆªé™¤?')) { store.config.services.splice(i, 1); forceSave(); } };
        window.addNewStaff = function() { store.config.staff.push({ id: 'st'+Date.now(), name: 'æ–°äººå“¡', image: 'ğŸ‘¤' }); forceSave(); };
        window.editStaff = function(i, f, v) { store.config.staff[i][f] = v; debouncedSave(); };
        window.deleteStaff = function(i) { if(confirm('åˆªé™¤?')) { store.config.staff.splice(i, 1); forceSave(); } };
        window.openEditProfile = function() { alert('(æ¨¡æ“¬) é–‹å•Ÿç·¨è¼¯å€‹äººè³‡æ–™è¦–çª—'); };

    </script>
</body>
</html>